<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ProductMapper">
	<select id="selectProduct" resultType="product">
		<![CDATA[
		SELECT * FROM (SELECT * FROM product ORDER BY dbms_random.value)
  	 	 WHERE rownum <= 5
  	 	 ]]>
	</select>
	<select id="selectProductDetail" resultType="product">
		SELECT * FROM product WHERE pseq=#{pseq}
	</select>
	
	<!-- 상품 전체갯수 조회 -->
	<select id="countProductList" parameterType="String" resultType="int">
		SELECT count(*) FROM product 
		WHERE name LIKE '%'||#{name}||'%'
	</select>
	
	<!-- 상품목록 조회 -->
	<select id="listProduct" parameterType="String" resultType="product">
		SELECT pseq, regdate, name, price1, price2, bestyn
		FROM product WHERE name LIKE '%'||#{name}||'%'
		ORDER BY name
	</select>
	
	<!-- 페이지별 상품 목록 조회 -->
	<select id="listProductWithPaging" resultType="product">
		<![CDATA[
		SELECT rn, pseq, regdate, name, price1, price2, bestyn
		FROM   (SELECT row_number() OVER (ORDER BY name) rn, pseq, regdate, name, price1, price2, bestyn
	        	FROM product 
	        	WHERE name LIKE '%'||#{name}||'%')
		WHERE rn <= #{criteria.pageNum} * #{criteria.rowsPerPage}  
		AND rn > (#{criteria.pageNum} - 1) * #{criteria.rowsPerPage}
		]]> 
	</select>
</mapper>